"""
–ú–æ–¥—É–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö.

–°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
–≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–≥–¥–∞-–ª–∏–±–æ –∑–∞–ø—É—Å–∫–∞–ª–∏ –±–æ—Ç–∞
–∏ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –µ–≥–æ. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫
–∞–∫—Ç–∏–≤–Ω—ã—Ö user_id, –ø–æ–ª—É—á–∞–µ–º—ã–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
"""

from aiogram import Bot
from database import get_all_active_user_ids
from logger_config import setup_logger

logger = setup_logger()


async def send_product_notification(bot: Bot, product: dict):
    """
    –†–∞—Å—Å—ã–ª–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —Ç–æ–≤–∞—Ä–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏–º –±–æ—Ç–∞.

    –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö user_id (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–∏ /start)
    –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞.
    –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Ä–∞—Å—Å—ã–ª–∫—É.

    Args:
        bot (Bot): –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.
        product (dict): –°–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–∞–º–∏ 'name', 'weight',
        'description', 'price', 'photo'.
    """
    user_ids = get_all_active_user_ids()
    caption = (
        "‚ú® –ù–æ–≤–∏–Ω–∫–∞ –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ!\n\n"
        f"ü´ñ {product['name']}\n"
        f"‚öñÔ∏è –í–µ—Å: {product['weight']} –≥\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {product['description']}\n"
        f"üí∞ –¶–µ–Ω–∞: {product['price']} ‚ÇΩ\n\n"
        "–°–∫–æ—Ä–µ–µ —Å–º–æ—Ç—Ä–∏ –∏ –∑–∞–∫–∞–∑—ã–≤–∞–π!"
    )
    for user_id in user_ids:
        try:
            await bot.send_photo(
                chat_id=user_id,
                photo=product['photo'],
                caption=caption
            )
        except Exception as e:
            logger.warning(
                f'–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}'
            )
